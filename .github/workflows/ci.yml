  name: CI
  on:
    pull_request:
      branches:
        - develop
        - master
        - qa
        - uat
  jobs:
    branch_name_lint:
      runs-on: ubuntu-latest
      name: Lint branch name
      steps:
        - uses: actions/checkout@v3
        - uses: lekterable/branchlint-action@2.0.0
          with:
            allowed: |
              develop
              master
              qa
              uat
              /(feature|bugfix|integration|rnd)/\w/i
            errorMessage: 'Branch should be always starting with (feature|bugfix|integration|rnd) and followed by /'
    flutter_analyze:
      runs-on: ubuntu-latest
      name: Run flutter analyze
      needs: [branch_name_lint]
      steps:
        - uses: actions/checkout@v4
        - uses: subosito/flutter-action@v2
          with:
            flutter-version: '3.16.9'
            channel: 'stable'
        - run: flutter --version
        - run: flutter pub get
        - run: flutter analyze
    flutter_test:
      runs-on: ubuntu-latest
      name: Run flutter test
      needs: [flutter_analyze]
      steps:
        - uses: actions/checkout@v4
        - uses: subosito/flutter-action@v2
          with:
            flutter-version: '3.16.9'
            channel: 'stable'
        - run: flutter pub get
        - run: flutter test
    flutter_build_appbundle:
      runs-on: ubuntu-latest
      name: Build flutter (Android)
      needs: [flutter_test]
      steps:
        - uses: actions/checkout@v4
        - uses: subosito/flutter-action@v2
          with:
            flutter-version: '3.16.9'
            channel: 'stable'
        - run: flutter pub get
        - run: flutter clean
        - run: flutter build appbundle
